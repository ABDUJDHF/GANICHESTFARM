-- ============================================
-- âœ… BLOX FRUITS - SAFE MODE V3 - CHEST3 PRIORITY âœ…
--      Made by Dev.Gani
--      Discord: d.6a
--      ğŸ’° Chest3 Ø£ÙˆÙ„Ø§Ù‹ Ø«Ù… Chest2 Ø«Ù… Chest1
-- ============================================
print("\n" .. string.rep("ğŸ’°", 50))
print("ğŸ’° BLOX FRUITS - CHEST3 PRIORITY EDITION ğŸ’°")
print("      Made by Dev.Gani")
print("      Discord: d.6a")
print("      ğŸ”¥ Chest3 > Chest2 > Chest1")
print(string.rep("ğŸ’°", 50) .. "\n")

-- âš¡ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
getgenv().Server_Hop = true
getgenv().Chest_Farm = true
getgenv().wait_Time = 9000
getgenv().AutoStopOnGodChalice = true

-- ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
local settingsFile = "DevGani_Settings.json"
local function loadSettings()
    local success, result = pcall(function()
        return game:GetService('HttpService'):JSONDecode(readfile(settingsFile))
    end)
    if success then
        getgenv().AutoStopOnGodChalice = result.AutoStopOnGodChalice
        print("âœ… Settings loaded: " .. (getgenv().AutoStopOnGodChalice and "ON" or "OFF"))
    else
        local defaultSettings = {AutoStopOnGodChalice = true}
        writefile(settingsFile, game:GetService('HttpService'):JSONEncode(defaultSettings))
        getgenv().AutoStopOnGodChalice = true
        print("ğŸ“ New settings file created - Auto-stop: ON")
    end
end
loadSettings()

-- ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
local function saveSettings()
    local settings = {AutoStopOnGodChalice = getgenv().AutoStopOnGodChalice}
    writefile(settingsFile, game:GetService('HttpService'):JSONEncode(settings))
end

-- ğŸ¨ Ø¥Ø´Ø¹Ø§Ø± Dev.Gani (Ù‚Ø§Ø¨Ù„ Ù„Ù„Ø³Ø­Ø¨)
spawn(function()
    wait(1)
    local gui = Instance.new("ScreenGui")
    gui.Name = "DevGaniNotif"
    gui.Parent = game:GetService("CoreGui")
    gui.ResetOnSpawn = false
    gui.IgnoreGuiInset = true
    
    local frame = Instance.new("Frame")
    frame.Parent = gui
    frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    frame.BackgroundTransparency = 0.2
    frame.BorderSizePixel = 0
    frame.Position = UDim2.new(0.75, 0, 0.02, 0)
    frame.Size = UDim2.new(0, 220, 0, 50)
    frame.Active = true
    frame.Draggable = true
    
    local corner = Instance.new("UICorner")
    corner.Parent = frame
    corner.CornerRadius = UDim.new(0, 10)
    
    local text = Instance.new("TextLabel")
    text.Parent = frame
    text.Size = UDim2.new(1, -10, 1, 0)
    text.Position = UDim2.new(0, 10, 0, 0)
    text.BackgroundTransparency = 1
    text.Text = "ğŸ’° Dev.Gani (Chest3 Priority)\nğŸ’¬ d.6a"
    text.TextColor3 = Color3.fromRGB(255, 215, 0)  -- Ø°Ù‡Ø¨ÙŠ
    text.TextScaled = true
    text.Font = Enum.Font.GothamBold
    text.TextXAlignment = Enum.TextXAlignment.Left
    
    wait(20)
    gui:Destroy()
end)

-- ğŸ® Ø²Ø± Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªØ­Ø±Ùƒ (Ù…ØµØºØ±)
spawn(function()
    wait(2)
    local s = Instance.new("ScreenGui")
    s.Name = "DevGaniControl"
    s.Parent = game:GetService("CoreGui")
    s.ResetOnSpawn = false
    s.IgnoreGuiInset = true
    
    local main = Instance.new("Frame")
    main.Parent = s
    main.BackgroundColor3 = Color3.fromRGB(10, 10, 10)
    main.BackgroundTransparency = 0.15
    main.BorderSizePixel = 0
    main.Position = UDim2.new(0.03, 0, 0.15, 0)
    main.Size = UDim2.new(0, 280, 0, 60)
    main.Active = true
    main.Draggable = true
    
    local mainCorner = Instance.new("UICorner")
    mainCorner.Parent = main
    mainCorner.CornerRadius = UDim.new(0, 12)
    
    local iconFrame = Instance.new("Frame")
    iconFrame.Parent = main
    iconFrame.BackgroundColor3 = getgenv().AutoStopOnGodChalice and Color3.fromRGB(0, 180, 0) or Color3.fromRGB(180, 0, 0)
    iconFrame.BackgroundTransparency = 0.1
    iconFrame.BorderSizePixel = 0
    iconFrame.Position = UDim2.new(0, 8, 0.5, -15)
    iconFrame.Size = UDim2.new(0, 30, 0, 30)
    
    local iconCorner = Instance.new("UICorner")
    iconCorner.Parent = iconFrame
    iconCorner.CornerRadius = UDim.new(0, 8)
    
    local icon = Instance.new("TextLabel")
    icon.Parent = iconFrame
    icon.Size = UDim2.new(1, 0, 1, 0)
    icon.BackgroundTransparency = 1
    icon.Text = getgenv().AutoStopOnGodChalice and "ğŸ›¡ï¸" or "âš”ï¸"
    icon.TextColor3 = Color3.fromRGB(255, 255, 255)
    icon.TextScaled = true
    icon.Font = Enum.Font.GothamBold
    
    -- Ø²Ø± ON/OFF
    local button = Instance.new("TextButton")
    button.Parent = main
    button.BackgroundColor3 = getgenv().AutoStopOnGodChalice and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(150, 0, 0)
    button.BackgroundTransparency = 0.2
    button.BorderSizePixel = 0
    button.Position = UDim2.new(0, 140, 0.5, -12)
    button.Size = UDim2.new(0, 40, 0, 24)
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.Parent = button
    buttonCorner.CornerRadius = UDim.new(0, 6)
    
    local buttonText = Instance.new("TextLabel")
    buttonText.Parent = button
    buttonText.Size = UDim2.new(1, 0, 1, 0)
    buttonText.BackgroundTransparency = 1
    buttonText.Text = getgenv().AutoStopOnGodChalice and "ON" or "OFF"
    buttonText.TextColor3 = Color3.fromRGB(255, 255, 255)
    buttonText.TextScaled = true
    buttonText.Font = Enum.Font.GothamBold
    
    -- Ø²Ø± STOP
    local stopButton = Instance.new("TextButton")
    stopButton.Parent = main
    stopButton.BackgroundColor3 = Color3.fromRGB(200, 50, 50)
    stopButton.BackgroundTransparency = 0.1
    stopButton.BorderSizePixel = 0
    stopButton.Position = UDim2.new(0, 190, 0.5, -12)
    stopButton.Size = UDim2.new(0, 55, 0, 24)
    
    local stopButtonCorner = Instance.new("UICorner")
    stopButtonCorner.Parent = stopButton
    stopButtonCorner.CornerRadius = UDim.new(0, 6)
    
    local stopButtonText = Instance.new("TextLabel")
    stopButtonText.Parent = stopButton
    stopButtonText.Size = UDim2.new(1, 0, 1, 0)
    stopButtonText.BackgroundTransparency = 1
    stopButtonText.Text = "â¹ï¸"
    stopButtonText.TextColor3 = Color3.fromRGB(255, 255, 255)
    stopButtonText.TextScaled = true
    stopButtonText.Font = Enum.Font.GothamBold
    
    -- ğŸ¯ ÙˆØ¸Ø§Ø¦Ù Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    stopButton.MouseButton1Click:Connect(function()
        getgenv().Chest_Farm = false
        print("\nğŸ›‘ MANUAL STOP: Chest farming stopped by user!")
    end)
    
    button.MouseButton1Click:Connect(function()
        getgenv().AutoStopOnGodChalice = not getgenv().AutoStopOnGodChalice
        getgenv().Chest_Farm = true
        
        iconFrame.BackgroundColor3 = getgenv().AutoStopOnGodChalice and Color3.fromRGB(0, 180, 0) or Color3.fromRGB(180, 0, 0)
        icon.Text = getgenv().AutoStopOnGodChalice and "ğŸ›¡ï¸" or "âš”ï¸"
        button.BackgroundColor3 = getgenv().AutoStopOnGodChalice and Color3.fromRGB(0, 150, 0) or Color3.fromRGB(150, 0, 0)
        buttonText.Text = getgenv().AutoStopOnGodChalice and "ON" or "OFF"
        saveSettings()
    end)
end)

-- ğŸ‘‘ Ø§Ø®ØªÙŠØ§Ø± ÙØ±ÙŠÙ‚ Pirates
spawn(function()
    wait(1.5)
    pcall(function()
        game:GetService("ReplicatedStorage").Remotes.CommF_:InvokeServer("SetTeam", "Pirates")
    end)
    print("âœ… Pirates team selected!")
end)

-- ============================================
-- ğŸ’°ğŸ’°ğŸ’° **CHEST3 PRIORITY - V3 EDITION** ğŸ’°ğŸ’°ğŸ’°
-- ============================================
spawn(function()
    wait(5)
    while task.wait(5) do
        if getgenv().Chest_Farm and game.Players.LocalPlayer.Character then
            pcall(function()
                local hrp = game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
                if not hrp then return end

                -- Ù‚Ø§Ø¦Ù…Ø© Ù„ØªØ®Ø²ÙŠÙ† ÙƒÙ„ Ø§Ù„ØµØ¯ÙˆØ± Ø§Ù„ØµØ§Ù„Ø­Ø©
                local validChests = {}

                -- âœ… Ø§Ù„ØªÙØªÙŠØ´ Ø§Ù„Ø¯Ù‚ÙŠÙ‚ Ø¹Ù„Ù‰ ÙƒÙ„ TouchTransmitter
                for _, touch in pairs(workspace:GetDescendants()) do
                    if touch:IsA("TouchTransmitter") then
                        local chest = touch.Parent
                        
                        -- ØªØ£ÙƒØ¯ Ø¥Ù† Ø§Ù„Ù€ Parent Ù‡Ùˆ Chest1/2/3 ÙˆÙ„Ø³Ù‡ Ù…ÙˆØ¬ÙˆØ¯
                        if chest and chest:IsA("BasePart") then
                            if chest.Name == "Chest1" or chest.Name == "Chest2" or chest.Name == "Chest3" then
                                if chest.Parent and chest:IsDescendantOf(workspace) then
                                    local dist = (hrp.Position - chest.Position).Magnitude
                                    local priority = chest.Name == "Chest3" and 1 or chest.Name == "Chest2" and 2 or 3
                                    
                                    table.insert(validChests, {
                                        chest = chest,
                                        dist = dist,
                                        priority = priority,
                                        name = chest.Name
                                    })
                                end
                            end
                        end
                    end
                end

                -- ğŸ”¥ğŸ”¥ğŸ”¥ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©: Chest3 Ø£ÙˆÙ„Ø§Ù‹ØŒ Ø«Ù… Ø§Ù„Ø£Ù‚Ø±Ø¨ ğŸ”¥ğŸ”¥ğŸ”¥
                table.sort(validChests, function(a, b)
                    if a.priority == b.priority then
                        return a.dist < b.dist  -- Ù†ÙØ³ Ø§Ù„Ù†ÙˆØ¹ØŒ Ø§Ù„Ø£Ù‚Ø±Ø¨ ÙŠÙÙˆØ²
                    end
                    return a.priority < b.priority  -- Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ© Ù„Ù„Ø£Ù‚Ù„ Ø±Ù‚Ù…Ø§Ù‹ (Chest3 = 1)
                end)

                -- ğŸ¯ Ø®Ø° Ø£ÙˆÙ„ Chest ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© (Ø§Ù„Ø£ÙØ¶Ù„ÙŠØ© Ø§Ù„Ù…Ø·Ù„Ù‚Ø© Ù„Ù€ Chest3)
                if #validChests > 0 then
                    local target = validChests[1]
                    print("ğŸ’° [PRIORITY] Taking " .. target.name .. " (Priority: " .. target.priority .. ")")
                    
                    hrp.CFrame = target.chest.CFrame * CFrame.new(0, 2, 0)
                    task.wait(0.1)

                    for i = 1, 4 do
                        firetouchinterest(hrp, target.chest, 0)
                        task.wait(0.02)
                        firetouchinterest(hrp, target.chest, 1)
                        task.wait(0.02)
                    end

                    if target.name == "Chest3" then 
                        print("ğŸ’°ğŸ’°ğŸ’° CHEST3 +2000 ğŸ’°ğŸ’°ğŸ’°")
                    end
                else
                    print("ğŸ’° No valid chests found")
                end
            end)
        end
    end
end)

-- ğŸ”¥ Ù†Ø¸Ø§Ù… Ø§Ù„Ø³ÙŠØ±ÙØ± Ù‡ÙˆÙ¾
local PlaceID = game.PlaceId
local AllIDs = {}
pcall(function() 
    AllIDs = game:GetService('HttpService'):JSONDecode(readfile("NotSameServers.json")) 
end)

function TPReturner()
    local Site = game.HttpService:JSONDecode(game:HttpGet('https://games.roblox.com/v1/games/' .. PlaceID .. '/servers/Public?sortOrder=Asc&limit=100'))
    for _, v in pairs(Site.data) do
        if v.playing < v.maxPlayers then
            local ID = tostring(v.id)
            local possible = true
            for _, e in pairs(AllIDs) do 
                if ID == tostring(e) then 
                    possible = false 
                    break 
                end 
            end
            if possible then
                table.insert(AllIDs, ID)
                writefile("NotSameServers.json", game:GetService('HttpService'):JSONEncode(AllIDs))
                game:GetService("TeleportService"):TeleportToPlaceInstance(PlaceID, ID, game.Players.LocalPlayer)
                wait(4)
                return true
            end
        end
    end
    return false
end

-- ÙƒØ´Ù Ø§Ù„ÙƒÙŠÙƒ
repeat wait() until game.CoreGui:FindFirstChild('RobloxPromptGui')
local po = game.CoreGui.RobloxPromptGui.promptOverlay
po.ChildAdded:Connect(function(a)
    if a.Name == 'ErrorPrompt' then
        print("\nğŸš¨ KICK DETECTED! FINDING NEW SERVER...")
        wait(1)
        TPReturner()
    end
end)

function Teleport()
    print("ğŸ”„ Server hopping...")
    TPReturner()
end

-- ğŸš€ Ø§Ù„Ù‚ÙØ² Ø§Ù„Ø¹Ø§Ø¯ÙŠ
spawn(function()
    while wait() do
        if getgenv().Server_Hop then
            wait(getgenv().wait_Time)
            Teleport()
        end
    end
end)

-- âœ… Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„
print("\n" .. string.rep("ğŸ’°", 35))
print("ğŸ’° CHEST3 PRIORITY MODE - ACTIVATED ğŸ’°")
print("âœ… Made by Dev.Gani | Discord: d.6a")
print("âœ… ğŸ”¥ Chest3 > Chest2 > Chest1")
print("âœ… ğŸ¥‡ Ø£ÙˆÙ„ÙˆÙŠØ© Ù…Ø·Ù„Ù‚Ø© Ù„Ù€ Chest3")
print("âœ… â±ï¸ Chest every 5 seconds")
print("âœ… ğŸ–±ï¸ Control panel is DRAGGABLE")
print(string.rep("ğŸ’°", 35) .. "\n")
